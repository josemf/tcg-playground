{
  "$id": "https://tennistcg.io/schema/ph5a-momentum.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Phase 5.1 â€” Momentum Window (Stack)",
  "type": "object",
  "required": ["$prev", "$curr", "$next", "context", "players", "phase"],
  "properties": {
    "$prev": { "type": "string", "format": "uri", "const": "https://tennistcg.io/schema/ph4b-direction-change.json" },
    "$curr": { "type": "string", "format": "uri", "const": "https://tennistcg.io/schema/ph5a-momentum.json" },
    "$next": { "type": "string", "format": "uri", "const": "https://tennistcg.io/schema/ph5b-mental.json" },
    "context": { "$ref": "https://tennistcg.io/schema/ph1-serve.json#/properties/context" },
    "players": { "$ref": "https://tennistcg.io/schema/ph1-serve.json#/properties/players" },
    "phase": {
      "type": "object",
      "required": ["id", "momentum"],
      "properties": {
        "id": { "type": "string", "const": "ph5a-momentum" },
        "momentum": {
          "type": "object",
          "required": ["window", "priority", "action", "stack", "rsqBefore"],
          "properties": {
            "window": { "type": "string", "enum": ["open", "resolved"] },
            "priority": { "type": "string", "enum": ["hitter", "defender"] },
            "action": { "type": "string", "enum": ["play", "pass", "resolve"] },
            "playedCard": {
              "type": "object",
              "properties": {
                "playerId": { "type": "string" },
                "name": { "type": "string" },
                "spCost": { "type": "integer", "minimum": 0 },
                "targets": { "type": "array", "items": { "type": "string" } },
                "rolls": { "type": "object", "additionalProperties": { "type": "integer" } },
                "text": { "type": "string" }
              }
            },
            "spAfterPlay": { "type": "integer", "minimum": 0 },
            "stack": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["id", "playerId", "name", "spCost", "countered"],
                "properties": {
                  "id": { "type": "string" },
                  "playerId": { "type": "string" },
                  "name": { "type": "string" },
                  "spCost": { "type": "integer", "minimum": 0 },
                  "targets": { "type": "array", "items": { "type": "string" } },
                  "rolls": { "type": "object", "additionalProperties": { "type": "integer" } },
                  "effect": { "type": "string" },
                  "countered": { "type": "boolean" }
                }
              }
            },
            "rsqBefore": { "type": "integer" },
            "rsqAfterResolve": { "type": "integer" }
          }
        }
      }
    }
  }
}
